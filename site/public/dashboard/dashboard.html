<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Sua empresa</title>

  <link rel="shortcut icon" href="../assets/img/Logo/CoffeeFlowLogo.svg" type="image/x-icon" />

  <!-- <link rel="stylesheet" href="login.css" /> -->
  <link rel="stylesheet" href="../css/menu.css" />
  <link rel="stylesheet" href="dash.css" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../js/script.js"></script>
  <script src="../js/alerta.js"></script>
  <script src="../js/sessao.js"></script>
  <script src="../js/dashboard.js"></script>
  <script src="../js/heatmap.js"></script>
</head>

<body onload="validarSessao(), obterDadosGrafico(lavoura.value, quadrante.value), setTimeout(() => obterDadosTeto(lavoura.value, quadrante.value), 200), setTimeout(() => atualizarGrafico(lavoura.value, quadrante.value), 2000);">
  <header>
    <ul class="ul-header">
      <div id="mySidenav" class="sidenav" style="width: 15px;">
        <a href="#" class="closebtn" onclick="closeNav()">&times;</a>
        <div class="content">
          <img src="../assets/img/SideBarDashboard/icon.svg" />
          <h3 id="nome" onload="nomeSessao()"></h3>
          <img style="width: 200px" src="../assets/img/SideBarDashboard/linha.svg" />
          <div class="options">
            <div class="dash-export">
              <div class="container">

                <div class="filtro">

                  <a href="/cadastrar.html" class="btn-add">
                    <p>+ Colaboradores</p>
                  </a>
                  <h4>Monitoramento</h4>
                  <div class="container-cordenadas">
                    <div class="cordenadas">
                      <div>
                        <b>Lavoura</b>
                        <select onchange="obterDadosGrafico(lavoura.value, quadrante.value)" name="Lavoura" id="lavoura">
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                          <option value="4">4</option>
                        </select>
                      </div>
                    </div>
                    <div class="cordenadas">
                      <div>
                        <b>Quadrante</b>
                        <select onchange="obterDadosGrafico(lavoura.value, quadrante.value)" name="Quadrante" id="quadrante">
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                          <option value="4">4</option>
                          <option value="5">5</option>
                          <option value="6">6</option>
                          <option value="7">7</option>
                          <option value="8">8</option>
                          <option value="9">9</option>
                          <option value="10">10</option>
                          <option value="11">11</option>
                          <option value="12">12</option>
                          <option value="13">13</option>
                          <option value="14">14</option>
                          <option value="15">15</option>
                          <option value="16">16</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="div-periodo">
                    <b>Período</b>
                    <select onchange="exibir(this)" id="periodo_min" style="font-family: 'Poppins'">
                      <option>Hoje</option>
                      <option>Ontem</option>
                      <option>Última semana</option>
                      <option>Últimos 30 dias</option>
                      <option>Últimos 6 meses</option>
                      <option>Últimos 12 meses</option>
                      <option value="Personalizado">Personalizado</option>
                    </select>
                  </div>

                  <div class="divs-dates" id="divs_dates">
                    <div>
                      <b>Data Mínima</b>
                      <input type="date">
                    </div>
                    <div>
                      <b>Data Máxima</b>
                      <input type="date">
                    </div>
                  </div>
                  <button id="btn">Filtrar</button>

                  <div class="div-exportacao">
                    <b>Exportar Dashboard</b>
                    <select class="select-export">
                      <option value="">CSV</option>
                      <option value="">XLS</option>
                      <option value="">Relatórios exportados</option>
                    </select>
                    <a href="https://docs.google.com/spreadsheets/d/1FJqMQo1yTkB6_d2RwS3vEYMuvBa5YM_7pDU6-PUdvyI/edit#gid=213062297"
                      class="btn-Export">
                      <p>Exportar</p>
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <span><img src="../assets/img/SideBarDashboard/help.svg">Ajuda</span>
            <span onclick="limparSessao()"><img src="../assets/img/SideBarDashboard/exit.svg">Sair</span>
          </div>
        </div>
        <div class="botaoSideNav" id="botaoSideNav" onmouseover="showNav()">
        </div>
      </div>
    </ul>
  </header>

  <div class="content" style="z-index: -2;">

    <div class="section1">
      <div class="grafico">
        <canvas id="temperatura"></canvas>
      </div>
      <div class="grafico">
        <canvas id="umidade"></canvas>
      </div>
    </div>
    <div class="section2">
      <div class="quadra3">
        <h1>Mapa de calor</h1>
        <div class="content">
          <div class="mapa">
            <h1>1</h1>
            <h1>2</h1>
            <h1>3</h1>
            <h1>4</h1>
            <h1>5</h1>
            <h1>6</h1>
            <h1>7</h1>
            <h1>8</h1>
            <h1>9</h1>
            <h1>10</h1>
            <h1>11</h1>
            <h1>12</h1>
            <h1>13</h1>
            <h1>14</h1>
            <h1>15</h1>
            <h1>16</h1>
          </div>
        </div>
      </div>
      <div class="kpi">
        <h1>Tudo o que você precisa saber</h1>
        <div class="linha1">
          <div class="elipse temp-interna">
            <h2 id="tempAtual">22°C</h2>
            <h3>Temperatura Interna atual</h3>
          </div>
          <div class="elipse temp-maxima">
            <h2 id="tempMax">26°C</h2>
            <h3>Temperatura Máxima do mês</h3>
          </div>
          <div class="elipse temp-minima">
            <h2 id="tempMin">15°C</h2>
            <h3>Temperatura Mínima do mês</h3>
          </div>
        </div>
        <div class="linha2" style="border-top: 3px dashed #666666">
          <div class="umidade">
            <canvas id="atualUmi"></canvas>
            <h1 id="atualUmidade"></h1>
            <h2>Umidade Atual</h2>
          </div>
          <div class="umidade">
            <canvas id="maiorUmi"></canvas>
            <h1 id="maiorUmidade"></h1>
            <h2>Maior Umidade no mês</h2>
          </div>
          <div class="umidade">
            <canvas id="menorUmi"></canvas>
            <h1 id="menorUmidade"></h1>
            <h2>Menor Umidade no mês</h2>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="notificacaoTempExt">
    <div>
      <div>
        <p><b id="p_titulo_msg_temp_ext"></b></p>
        <p id="p_auxiliarTempExt"></p>
      </div>
    </div>
  </div>
  <img width="55px" src="" alt="" id="thumbsTempExt">

  <div class="notificacaoTempSolo">
    <div>
      <div>
        <p><b id="p_titulo_msg_temp_solo"></b></p>
        <p id="p_auxiliarTempSolo"></p>
      </div>
    </div>
  </div>
  <img width="55px" src="" alt="" id="thumbsTempSolo">

  <div class="notificacaoUmi">
    <div>
      <div>
        <p><b id="p_titulo_msg_umi"></b></p>
        <p id="p_auxiliarUmi"></p>
      </div>
    </div>
  </div>
  <img width="55px" src="" alt="" id="thumbsUmi">
</body>

</html>
<script>

  // Seleciona o icon de notificação
  const iconNotiTempExt = document.querySelector('#thumbsTempExt');
  const iconNotiTempSolo = document.querySelector('#thumbsTempSolo');
  const iconNotiUmi = document.querySelector('#thumbsUmi');

  // Seleciona a div da notificação
  const notificacaoTempExt = document.querySelector('.notificacaoTempExt');
  const notificacaoTempSolo = document.querySelector('.notificacaoTempSolo');
  const notificacaoUmi = document.querySelector('.notificacaoUmi');

  var tirarTimeout;

  // Para Temperatura Externa
  // Adiciona um evento de hover à outra div
  iconNotiTempExt.addEventListener('mouseover', () => {
    // Mostra a notificação ao passar o mouse sobre o icon de notificação
    notificacaoTempExt.style.display = 'flex';
    // notificacaoTemp.style.width = '23%';
    notificacaoTempExt.style.opacity = '1';

    // 'limpa' o setTimeout da outra função abaixo, para não ficar lento a exibição da notificação
    clearTimeout(tirarTimeout);
  });

  iconNotiTempExt.addEventListener('mouseout', () => {
    // Esconde a notificação ao tirar o mouse do icon de notificação
    // notificacaoTemp.style.width = '0';
    notificacaoTempExt.style.opacity = '0';

    tirarTimeout = setTimeout(() => {
      notificacaoTempExt.style.display = 'none';
      // notificacaoTemp.style.opacity = '0';

    }, 550);

  });

   // Para Temperatura do Solo
   iconNotiTempSolo.addEventListener('mouseover', () => {

    notificacaoTempSolo.style.display = 'flex';
    notificacaoTempSolo.style.opacity = '1';

    clearTimeout(tirarTimeout);
  });

  iconNotiTempSolo.addEventListener('mouseout', () => {

    notificacaoTempSolo.style.opacity = '0';

    tirarTimeout = setTimeout(() => {
      notificacaoTempSolo.style.display = 'none';

    }, 550);

  });

  // Para Umidade

  iconNotiUmi.addEventListener('mouseover', () => {
    notificacaoUmi.style.display = 'flex';
    // notificacaoUmi.style.width = '21%';
    notificacaoUmi.style.opacity = '1';

    clearTimeout(tirarTimeout);
  });

  iconNotiUmi.addEventListener('mouseout', () => {
    // notificacaoUmi.style.width = '0';
    notificacaoUmi.style.opacity = '0';

    tirarTimeout = setTimeout(() => {
      notificacaoUmi.style.display = 'none';
      // notificacaoUmi.style.opacity = '0';

    }, 550);
  });

  // Função para processar os dados
  // function processarDados(dados) {
  //   var { temperaturaExt, temperaturaSolo, umidade } = dados;

  //   var mensagemTempExt = "";
  //   var mensagemTempSolo = "";
  //   var mensagemUmi = "";

  //     if (temperaturaExt <= 10) {
  //       thumbsTempExt.style.display = 'flex';
  //       mensagemTempExt += `Crítico: Temperatura Externa muito baixa!<br>`;
  //       thumbsTempExt.src = "../assets/img/dashboard/iconCriticoTempExt.svg";
  //       thumbsTempExt.style.backgroundColor = "#7AFDFF";
  //       p_auxiliarTempExt.innerHTML += "Proteja as plantas do frio intenso. Ajuste os cuidados para evitar danos aos cafezais.<br>"
  //     } else if (temperaturaExt <= 15) {
  //       thumbsTempExt.style.display = 'flex';
  //       mensagemTempExt += `Alerta: Temperatura Externa baixa!<br>`;
  //       thumbsTempExt.src = "../assets/img/dashboard/iconAlertaTempExt.svg";
  //       thumbsTempExt.style.backgroundColor = "#9CDBC0";
  //       p_auxiliarTempExt.innerHTML += "Temperatura fresca lá fora. Ajuste os cuidados para manter o conforto das plantas de café.<br>"
  //     } else if (temperaturaExt >= 27 && temperaturaExt < 34) {
  //       thumbsTempExt.style.display = 'flex';
  //       mensagemTempExt += `Alerta: Temperatura Externa alta!<br>`;
  //       thumbsTempExt.src = "../assets/img/dashboard/iconAlertaTempExt.svg";
  //       thumbsTempExt.style.backgroundColor = "#C9B167";
  //       p_auxiliarTempExt.innerHTML += "Ajuste a irrigação para proteger os cafezais do calor excessivo.<br>"
  //     } else if (temperaturaExt >= 34) {
  //       thumbsTempExt.style.display = 'flex';
  //       mensagemTempExt += `Crítico: Temperatura Externa muito alta!<br>`;
  //       thumbsTempExt.src = "../assets/img/dashboard/iconCriticoTempExt.svg";
  //       thumbsTempExt.style.backgroundColor = "#FF7200";
  //       p_auxiliarTempExt.innerHTML += "Calor extremo lá fora. Adapte a irrigação para evitar danos às plantas.<br>"
  //     } else {
  //       thumbsTempExt.style.display = 'none';
  //   } 
       

  //   if (temperaturaSolo <= 8) {
  //     thumbsTempSolo.style.display = 'flex';
  //     mensagemTempSolo += `Crítico: Temperatura do Solo muito baixa!<br>`;
  //     thumbsTempSolo.src = "../assets/img/dashboard/iconCriticoTempSolo.svg";
  //     thumbsTempSolo.style.backgroundColor = "#7AFDFF";
  //     p_auxiliarTempSolo.innerHTML += "Ajuste a irrigação para proteger as mudas de café do frio.<br>"
  //   } else if (temperaturaSolo <= 12) {
  //     thumbsTempSolo.style.display = 'flex';
  //     mensagemTempSolo += `Alerta: Temperatura do Solo baixa!<br>`;
  //     thumbsTempSolo.src = "../assets/img/dashboard/iconAlertaTempSolo.svg";
  //     thumbsTempSolo.style.backgroundColor = "#9CDBC0";
  //     p_auxiliarTempSolo.innerHTML += "Ajuste os aspersores para evitar perdas na lavoura.<br>"
  //   } else if (temperaturaSolo >= 25 && temperaturaSolo < 33) {
  //     thumbsTempSolo.style.display = 'flex';
  //     mensagemTempSolo += `Alerta: Temperatura do Solo alta!<br>`;
  //     thumbsTempSolo.src = "../assets/img/dashboard/iconAlertaTempSolo.svg";
  //     thumbsTempSolo.style.backgroundColor = "#C9B167";
  //     p_auxiliarTempSolo.innerHTML += "Ajuste a irrigação para evitar estresse nas raízes do café.<br>"
  //   } else if (temperaturaSolo >= 33) {
  //     thumbsTempSolo.style.display = 'flex';
  //     mensagemTempSolo += `Crítico: Temperatura do Solo muito alta!<br>`;
  //     thumbsTempSolo.src = "../assets/img/dashboard/iconCriticoTempSolo.svg";
  //     thumbsTempSolo.style.backgroundColor = "#FF7200";
  //     p_auxiliarTempSolo.innerHTML += "Aumente a frequência de irrigação para compensar o calor.<br>"
  //   } else {
  //     thumbsTempSolo.style.display = 'none';
  //  } 
  
  //   document.getElementById('p_titulo_msg_temp_ext').innerHTML = mensagemTempExt;
  //   document.getElementById('p_titulo_msg_temp_solo').innerHTML = mensagemTempSolo;

  //   if (umidade <= 50) {
  //     thumbsUmi.style.display = 'flex';
  //     mensagemUmi += `Crítico: Umidade do Solo muito baixa!<br>`;
  //     thumbsUmi.src = "../assets/img/dashboard/iconCriticoHumi.svg";
  //     thumbsUmi.style.backgroundColor = "#FFFF60";
  //     p_auxiliarUmi.innerHTML += "Ajuste a irrigação para garantir a umidade necessária.<br>";
  //   } else if (umidade <= 60) {
  //     thumbsUmi.style.display = 'flex';
  //     mensagemUmi += `Alerta: Umidade do Solo baixa!<br>`;
  //     thumbsUmi.src = "../assets/img/dashboard/iconAlertaHumi.svg";
  //     thumbsUmi.style.backgroundColor = "#A0FF67";
  //     p_auxiliarUmi.innerHTML += "Ajuste a irrigação para manter o equilíbrio hídrico nas raízes do café.<br>"
  //   } else if (umidade >= 80 && umidade < 97) {
  //     thumbsUmi.style.display = 'flex';
  //     mensagemUmi += `Alerta: Umidade do Solo alta!<br>`;
  //     thumbsUmi.src = "../assets/img/dashboard/iconAlertaHumi.svg";
  //     thumbsUmi.style.backgroundColor = "#109C77";
  //     p_auxiliarUmi.innerHTML += "Reduza a irrigação para evitar excesso de umidade.<br>";
  //   } else if (umidade >= 97) {
  //     thumbsUmi.style.display = 'flex';
  //     mensagemUmi += `Crítico: Umidade do Solo muito alta!<br>`;
  //     thumbsUmi.src = "../assets/img/dashboard/iconCriticoHumi.svg";
  //     thumbsUmi.style.backgroundColor = "#007A7A";
  //     p_auxiliarUmi.innerHTML += "Ajuste a irrigação para proteger as raízes do café.<br>";
  //   } else {
  //     thumbsUmi.style.display = 'none';
  // } 
  //   document.getElementById('p_titulo_msg_umi').innerHTML = mensagemUmi;

  // }

  // var dadosSimulados = {
  //   temperaturaExt: 10,
  //   temperaturaSolo: 90,
  //   umidade: 100
  // };
  // // Chama a função para processar os dados simulados
  // processarDados(dadosSimulados);


  // minimal heatmap instance configuration
  var heatmapInstance = h337.create({
    // only container is required, the rest will be defaults
    container: document.querySelector('.mapa'),
    // backgroundColor: 'red',
    maxOpacity: .5,
    minOpacity: .5,
    // custom gradient colors
    gradient: {
      // enter n keys between 0 and 1 here
      // for gradient color customization
      '0.2': '#7afdff',
      '0.3': '#9cdbc0',
      '0.5': '#bdc771',
      '0.625': '#c9b167',
      '0.825': '#ff7200'
    }
  });

  // now generate some random data
  var points = [];
  var max = 40;
  var width = 450;
  var height = 250;

  var minT = 8;
  var intervalo = max - minT;
  
  var posX = 28;

  for(var contadorSensor = 1; contadorSensor<=16; contadorSensor++){
    
    var posY = 62;
    if(contadorSensor % 2 == 0){
      posY = 187;
    }else{
      posX = 28;
      posX = posX * contadorSensor;
    }

    var sensor = {
      x: posX,
      y: posY,
      value: Math.floor(minT + Math.random() * intervalo),
      radius: 100,
    }
    points.push(sensor);
  }

  var data = {
    max: 40,
    data: points,
  };

  heatmapInstance.setData(data);
  console.log(points)
  // heatmap data format

  // if you have a set of datapoints always use setData instead of addData
  // for data initialization

  //ChartJS Umidade (pizza ao meio)
  const pizzaUmidadeMim = document.getElementById("menorUmi");
  const pizzaUmidadeMax = document.getElementById("maiorUmi");
  const pizzaUmidadeAtual = document.getElementById("atualUmi");

  Chart.defaults.color = "#666666"

  const umidadeBaixa = 46;

  const dataPizzaMenor = {
    datasets: [
      {
        label: "Umidade",
        data: [],
        backgroundColor: [
          "#ffff60",
          "#EAE8DB",
        ],
        hoverOffset: 4,
        circumference: 180,
        rotation: -90,
      },
    ],
  };

  const configPizzaMenor = {
    type: "doughnut",
    data: dataPizzaMenor,
  };

  // menorUmidade.innerHTML = umidadeBaixa + "%";

  const umidadeAlta = 99;

  const dataPizzaMaior = {
    datasets: [
      {
        label: "Umidade",
        data: [],
        backgroundColor: [
          "#007a7a",
          "#EAE8DB",
        ],
        hoverOffset: 4,
        circumference: 180,
        rotation: -90,
      },
    ],
  };

  const configPizzaMaior = {
    type: "doughnut",
    data: dataPizzaMaior,
  };

  // maiorUmidade.innerHTML = umidadeAlta + "%";

  const umidadeAtual = 75;

  const dataPizzaAtual = {
    datasets: [
      {
        label: "Umidade",
        data: [umidadeAtual, 100 - umidadeAtual],
        backgroundColor: [
          "#20db74",
          "#EAE8DB",
        ],
        hoverOffset: 4,
        circumference: 180,
        rotation: -90,
      },
    ],
  };

  const configPizzaAtual = {
    type: "doughnut",
    data: dataPizzaAtual,
  };

  atualUmidade.innerHTML = umidadeAtual + "%";


  chartUmidadeMin = new Chart(pizzaUmidadeMim, configPizzaMenor);
  chartUmidadeMax = new Chart(pizzaUmidadeMax, configPizzaMaior);
  const umidade = new Chart(pizzaUmidadeAtual, configPizzaAtual);

</script>